<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>3. Mapping</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="3. Mapping">3. Mapping</a></h1><h2><a name="3.1 QuickStart">3.1 QuickStart</a></h2><h4>Default mapping</h4>
To declare a domain class to be searchable, the simpliest way is to define the following static property in the code:
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span></pre></div>
The plugin will generate a default mapping for each properties of the domain.<p class="paragraph"/><h4>Custom mapping</h4>
You can customize how each properties are mapped to the index using a closure. The syntax is similar to GORM's mapping DSL.
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = &#123;
    // mapping DSL&#8230;
&#125;</pre></div>
See below for more details on the mapping DSL.<p class="paragraph"/><h4>Limit properties with only/except</h4>
<code>only</code> and <code>except</code> are used to limit the properties that are made searchable.
You may not define both except &#38; only settings at the same time.<p class="paragraph"/>The following code will only map the 'message' property, any others will be ignored.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        only = 'message'
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/>The following code will map all properties except the one specified.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        except = 'someUselessField'
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/>You can use a Collection to specify several properties.
<div class="code"><pre>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        except = &#91;'someUselessField', 'userName'&#93;
    &#125;
    <span class="java&#45;object">String</span> message
    <span class="java&#45;object">String</span> userName
    <span class="java&#45;object">String</span> someUselessField
&#125;</pre></div><p class="paragraph"/><blockquote class="note">The properties that are ignored will not be sent to ElasticSearch. It also means that when you will get back a domain
from ElasticSearch, some fields that are not supposed to be null, may still be null.</blockquote><h2><a name="3.2 Class mapping">3.2 Class mapping</a></h2><h4>root</h4>
Determine if the domain class will have its own index or not. Take a boolean as parameter, and is set to <code>true</code> by default.
<div class="code"><pre>class Preference &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        root <span class="java&#45;keyword">false</span>
    &#125;
    // &#8230;
&#125;<p class="paragraph"/>class Tag &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span>
    // &#8230;
&#125;<p class="paragraph"/>class Tweet &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        message boost:2.0
    &#125;
    // &#8230;
&#125;</pre></div>
In this code, the classes <code>Tweet</code> and <code>Tag</code> are going to have their own index. The class <code>Preference</code> will not.
It also mean that any search request will never return a Preference-type hit. The dynamic method <code>search</code> will not be
injected in the <code>Preference</code> domain class.
The domains not root-mapped can still be considered searchable, as they can be components of another domain which is root-mapped.
For example, considered the following domain:
<div class="code"><pre>class User &#123;
    <span class="java&#45;keyword">static</span> searchable = &#123;
        userPreferences component:<span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    Preference userPreferences
&#125;</pre></div>
When searching, any matches in the <code>userPreferences</code> property will be considered as a <code>User</code> match.<h2><a name="3.3 Properties mapping">3.3 Properties mapping</a></h2>You can customize the mapping for each domain properties using the closure mapping.
The syntax is simple:
<div class="code"><pre><span class="java&#45;keyword">static</span> searchable = &#123;
    propertyName option1:value, option2:value, &#8230;
&#125;</pre></div>
<strong class="bold">Available options</strong>
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Option name</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td>boost</td><td>A decimal boost value. With a positive value, promotes search results for hits in this property; with a negative value, demotes search results that hit this property.</td></tr><tr class="table-even"><td>component</td><td>To use only on domain (or collection of domains), make the property a searchable component.</td></tr><tr class="table-odd"><td>converter</td><td>A <code>Class</code> to use as a converter during the marshalling/unmarshalling process for that peculiar property. That class must extends the <code>PropertyEditorSupport</code> java class.</td></tr><tr class="table-even"><td>excludeFromAll</td><td>A boolean, determines if the property is to append in the <code>"_all"</code> field. Default to <code>true</code>.</td></tr><tr class="table-odd"><td>index</td><td>How or if the property is made into searchable element. One of <code>"no"</code>, <code>"not_analyzed"</code> or <code>"analyzed"</code>.</td></tr><tr class="table-even"><td>reference</td><td>To use only on domain (or collection of domains), make the property a searchable reference.</td></tr></table><h2><a name="3.4 Searchable Component-Reference">3.4 Searchable Component-Reference</a></h2>The plugin support a similar searchable-component &#38; searchable-reference behavior from Compass
when you are dealing with domain association.
See below to find out about the difference between both mapping modes.
<h2><a name="3.4.1 Searchable Reference">3.4.1 Searchable Reference</a></h2>The searchable-reference mapping mode is the default mode used for association, and requires the
searchable class of the association to be root-mapped in order to have its own index.
With this mode, the associated domains are not completely marshalled in the resulting JSON document:
only the id and the type of the instances are kept.
When the document is retrieved from the index, the plugin will automatically rebuild the association from the
indices using the stored id.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>class MyDomain &#123;
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        odom reference:<span class="java&#45;keyword">true</span>
    &#125;
&#125;<p class="paragraph"/>// The OtherDomain definition, with <span class="java&#45;keyword">default</span> searchable configuration
class OtherDomain &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span><p class="paragraph"/>    <span class="java&#45;object">String</span> field1 = <span class="java&#45;quote">"val1"</span>
    <span class="java&#45;object">String</span> field2 = <span class="java&#45;quote">"val2"</span>
    <span class="java&#45;object">String</span> field3 = <span class="java&#45;quote">"val3"</span>
    <span class="java&#45;object">String</span> field4 = <span class="java&#45;quote">"val4"</span>
&#125;</pre></div><p class="paragraph"/>When indexing an instance of MyDomain, the resulting JSON documents will be sent to ElasticSearch:
<div class="code"><pre>&#123;
    <span class="java&#45;quote">"mydomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"odom"</span>: &#123; <span class="java&#45;quote">"id"</span>:1 &#125;
    &#125;
&#125;<p class="paragraph"/>&#123;
    <span class="java&#45;quote">"otherdomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"field1"</span>:<span class="java&#45;quote">"val1"</span>,
        <span class="java&#45;quote">"field2"</span>:<span class="java&#45;quote">"val2"</span>,
        <span class="java&#45;quote">"field3"</span>:<span class="java&#45;quote">"val3"</span>,
        <span class="java&#45;quote">"field4"</span>:<span class="java&#45;quote">"val4"</span>
    &#125;
&#125;</pre></div><h2><a name="3.4.2 Searchable Component">3.4.2 Searchable Component</a></h2>The searchable-component mapping mode must be explicitly set, and does not require the
searchable class of the association to be root-mapped.
With this mode, the associated domains are nested in the parent document.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>class MyDomain &#123;
    // odom is an association with the OtherDomain class, set as a reference
    OtherDomain odom<p class="paragraph"/>    <span class="java&#45;keyword">static</span> searchable = &#123;
        odom component:<span class="java&#45;keyword">true</span>
    &#125;
&#125;<p class="paragraph"/>// The OtherDomain definition, with <span class="java&#45;keyword">default</span> searchable configuration
class OtherDomain &#123;
    <span class="java&#45;keyword">static</span> searchable = <span class="java&#45;keyword">true</span><p class="paragraph"/>    <span class="java&#45;object">String</span> field1 = <span class="java&#45;quote">"val1"</span>
    <span class="java&#45;object">String</span> field2 = <span class="java&#45;quote">"val2"</span>
    <span class="java&#45;object">String</span> field3 = <span class="java&#45;quote">"val3"</span>
    <span class="java&#45;object">String</span> field4 = <span class="java&#45;quote">"val4"</span>
&#125;</pre></div><p class="paragraph"/>When indexing an instance of MyDomain, the resulting JSON document will be sent to ElasticSearch:
<div class="code"><pre>&#123;
    <span class="java&#45;quote">"mydomain"</span>: &#123;
        <span class="java&#45;quote">"_id"</span>:1,
        <span class="java&#45;quote">"odom"</span>: &#123;
            <span class="java&#45;quote">"_id"</span>:1,
            <span class="java&#45;quote">"field1"</span>:<span class="java&#45;quote">"val1"</span>,
            <span class="java&#45;quote">"field2"</span>:<span class="java&#45;quote">"val2"</span>,
            <span class="java&#45;quote">"field3"</span>:<span class="java&#45;quote">"val3"</span>,
            <span class="java&#45;quote">"field4"</span>:<span class="java&#45;quote">"val4"</span>
        &#125;
    &#125;
&#125;</pre></div>
    </body>
</html>
