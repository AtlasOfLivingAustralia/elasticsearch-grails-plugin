<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>5.3 Highlighting</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    The search method support highlighting: automatic wrapping of the matching terms in the search results with
HTML/XML/Whatever tags.
You can activate this with a <code>Closure</code> containing the highlight settings in the search method <code>highlight</code> parameter.
The format of the <code>Closure</code> for defining the highlight settings is the same as the
<a href="http://www.elasticsearch.org/guide/reference/api/search/highlighting.html" target="blank">ElasticSearch REST API</a>.<p class="paragraph"/><strong class="bold">Example</strong>
<div class="code"><pre>// Define the pre &#38; post tag that will wrap each term matched in the document.
def highlighter = &#123;
  field 'message'
  field 'tags.name'
  preTags '&#60;strong&#62;'
  postTags '&#60;/strong&#62;'
&#125;<p class="paragraph"/>def results = Tweet.search(<span class="java&#45;quote">"$&#123;params.query&#125;"</span>, &#91;highlight: highlightSettings&#93;)</pre></div><p class="paragraph"/><h3>Highlight results</h3>
If a search result is found, the <code>search</code> method will add a <code>highlight</code> entry in the map result.
That entry contains a <code>List</code> with every highlighted fragments/fields found for each hit.<p class="paragraph"/><div class="code"><pre>def results = Tweet.search(<span class="java&#45;quote">"$&#123;params.query&#125;"</span>, &#91;highlight: &#123; field 'message' &#125;&#93;)
def highlighted = results.highlight<p class="paragraph"/>results?.searchResults?.eachWithIndex &#123; hit, index &#45;&#62;
    // Retrieve the 'message' field fragments <span class="java&#45;keyword">for</span> the current hits
    def fragments = highlighted&#91;index&#93;.message?.fragments<p class="paragraph"/>    // Print the fragment
    println fragments?.size() ? fragments&#91;0&#93; : ''
&#125;</pre></div><p class="paragraph"/><h3>Highlighted fields</h3>
To determine which fields are to be processed by ElasticSearch, use the <code>field</code> setting.
You can call the <code>field</code> setting as many time as you want to add any field.<p class="paragraph"/><strong class="bold">Signature</strong>
<div class="code"><pre>field &#60;fieldName&#62;&#91;, &#60;fragmentSize&#62;&#91;, &#60;numberOfFragment&#62;&#93;&#93;</pre></div><p class="paragraph"/><strong class="bold">Examples</strong>
<div class="code"><pre>def highlightSettings = &#123;
    field 'message'                    // Add the 'message' field in the highlighted fields list
    field 'tags.name'                  // Add the 'name' field contained in the 'tags' field of
                                       // the document in the highlighted fields list
    field 'thatAwesomeField', 0, 20    // Add the 'thatAwesomeField' field with
                                       // some values fixed <span class="java&#45;keyword">for</span> fragmentSize and numberOfFragment parameters
&#125;<p class="paragraph"/>def highlightSettings2 = &#123;
    field '_all'                       // Add the special '_all' field in the highlighted fields list
&#125;<p class="paragraph"/>def results = Tweet.search(<span class="java&#45;quote">"$&#123;params.query&#125;"</span>, &#91;highlight: highlightSettings&#93;)
def results2 = Tweet.search(<span class="java&#45;quote">"$&#123;params.query&#125;"</span>, &#91;highlight: highlightSettings2&#93;)</pre></div><p class="paragraph"/><h3>Highlighting tags</h3>
By default, ElasticSearch will use emphasis tag "<code>&#60;em&#62;...&#60;/em&#62;</code>" to wrap the matching text.
You can customize the tags with the <code>preTags</code> and <code>postTags</code> settings.<p class="paragraph"/><div class="code"><pre>def highlightSettings = &#123;
    field 'message'
    preTags '&#60;myAweSomeTag&#62;'
    postTags '&#60;/myAweSomeTag&#62;'
&#125;</pre></div>
    </body>
</html>
